<template>
  <div>
    <h2 class="my-1">Trending projects</h2>
    <!-- Sponsored -->
    <ul v-if="!$fetchState.pending" role="list" class="divide-y divide-gray-200">
      <!-- sponsored -->
      <li v-if="topProject" class="px-4 py-4 bg-white rounded-lg sm:px-0 hover:bg-gray-50 sm:hover:bg-transparent">
        <ProjectListItem :data="topProject" :sponsored="true" />
      </li>

      <!--- top 5 projects -->
      <li v-for="(project, key) in projects" :key="key" class="px-4 py-4 bg-white rounded-lg sm:px-0 hover:bg-gray-50 sm:hover:bg-transparent">
        <ProjectListItem :data="project" index-prefix="#" :index="key + 1" :sponsored="false" />
      </li>
    </ul>
  </div>
</template>

<script>
import ProjectListItem from '@/components/Home/ProjectListItem.vue'

export default {
  components: {
    ProjectListItem
  },
  data() {
    return {
      topProject: () => {},
      projects: () => {}
    }
  },
  fetchDelay: 100,
  async fetch() {
    // const topId = await this.$axios.get('/api/spot', { params: { id: 2 } })
    const topId = 170

    const { data: spotData } = await this.$supabase
      .from('projects')
      .select('*')
      .eq('id', topId)
      .single()

    if (spotData) {
      this.topProject = spotData
    }

    const { data, error } = await this.$supabase
      .from('projects')
      .select('*')
      .order('view_count', { ascending: false })
      .limit(5)

    if (error) {
      throw new Error('No project found')
    }

    if (data) {
      const BUCKET = 'public'
      const bannerName = data.banner_name
      const bannerDefault =
        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABXgAAADGCAYAAABo8+iVAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAFeKADAAQAAAABAAAAxgAAAABD74J8AAAUxUlEQVR4Ae3Y0QkAIAxDQXX/VTuDgls8uE4QLv3Knpm7HAECBAgQIECAAAECBAgQIECAAAECBAjkBE4uscAECBAgQIAAAQIECBAgQIAAAQIECBAg8AUMvB6BAAECBAgQIECAAAECBAgQIECAAAECUQEDb7Q4sQkQIECAAAECBAgQIECAAAECBAgQIGDg9QMECBAgQIAAAQIECBAgQIAAAQIECBCIChh4o8WJTYAAAQIECBAgQIAAAQIECBAgQIAAAQOvHyBAgAABAgQIECBAgAABAgQIECBAgEBUwMAbLU5sAgQIECBAgAABAgQIECBAgAABAgQIGHj9AAECBAgQIECAAAECBAgQIECAAAECBKICBt5ocWITIECAAAECBAgQIECAAAECBAgQIEDAwOsHCBAgQIAAAQIECBAgQIAAAQIECBAgEBUw8EaLE5sAAQIECBAgQIAAAQIECBAgQIAAAQIGXj9AgAABAgQIECBAgAABAgQIECBAgACBqICBN1qc2AQIECBAgAABAgQIECBAgAABAgQIEDDw+gECBAgQIECAAAECBAgQIECAAAECBAhEBQy80eLEJkCAAAECBAgQIECAAAECBAgQIECAgIHXDxAgQIAAAQIECBAgQIAAAQIECBAgQCAqYOCNFic2AQIECBAgQIAAAQIECBAgQIAAAQIEDLx+gAABAgQIECBAgAABAgQIECBAgAABAlEBA2+0OLEJECBAgAABAgQIECBAgAABAgQIECBg4PUDBAgQIECAAAECBAgQIECAAAECBAgQiAoYeKPFiU2AAAECBAgQIECAAAECBAgQIECAAAEDrx8gQIAAAQIECBAgQIAAAQIECBAgQIBAVMDAGy1ObAIECBAgQIAAAQIECBAgQIAAAQIECBh4/QABAgQIECBAgAABAgQIECBAgAABAgSiAgbeaHFiEyBAgAABAgQIECBAgAABAgQIECBAwMDrBwgQIECAAAECBAgQIECAAAECBAgQIBAVMPBGixObAAECBAgQIECAAAECBAgQIECAAAECBl4/QIAAAQIECBAgQIAAAQIECBAgQIAAgaiAgTdanNgECBAgQIAAAQIECBAgQIAAAQIECBAw8PoBAgQIECBAgAABAgQIECBAgAABAgQIRAUMvNHixCZAgAABAgQIECBAgAABAgQIECBAgICB1w8QIECAAAECBAgQIECAAAECBAgQIEAgKmDgjRYnNgECBAgQIECAAAECBAgQIECAAAECBAy8foAAAQIECBAgQIAAAQIECBAgQIAAAQJRAQNvtDixCRAgQIAAAQIECBAgQIAAAQIECBAgYOD1AwQIECBAgAABAgQIECBAgAABAgQIEIgKGHijxYlNgAABAgQIECBAgAABAgQIECBAgAABA68fIECAAAECBAgQIECAAAECBAgQIECAQFTAwBstTmwCBAgQIECAAAECBAgQIECAAAECBAgYeP0AAQIECBAgQIAAAQIECBAgQIAAAQIEogIG3mhxYhMgQIAAAQIECBAgQIAAAQIECBAgQMDA6wcIECBAgAABAgQIECBAgAABAgQIECAQFTDwRosTmwABAgQIECBAgAABAgQIECBAgAABAgZeP0CAAAECBAgQIECAAAECBAgQIECAAIGogIE3WpzYBAgQIECAAAECBAgQIECAAAECBAgQMPD6AQIECBAgQIAAAQIECBAgQIAAAQIECEQFDLzR4sQmQIAAAQIECBAgQIAAAQIECBAgQICAgdcPECBAgAABAgQIECBAgAABAgQIECBAICpg4I0WJzYBAgQIECBAgAABAgQIECBAgAABAgQMvH6AAAECBAgQIECAAAECBAgQIECAAAECUQEDb7Q4sQkQIECAAAECBAgQIECAAAECBAgQIGDg9QMECBAgQIAAAQIECBAgQIAAAQIECBCIChh4o8WJTYAAAQIECBAgQIAAAQIECBAgQIAAAQOvHyBAgAABAgQIECBAgAABAgQIECBAgEBUwMAbLU5sAgQIECBAgAABAgQIECBAgAABAgQIGHj9AAECBAgQIECAAAECBAgQIECAAAECBKICBt5ocWITIECAAAECBAgQIECAAAECBAgQIEDAwOsHCBAgQIAAAQIECBAgQIAAAQIECBAgEBUw8EaLE5sAAQIECBAgQIAAAQIECBAgQIAAAQIGXj9AgAABAgQIECBAgAABAgQIECBAgACBqICBN1qc2AQIECBAgAABAgQIECBAgAABAgQIEDDw+gECBAgQIECAAAECBAgQIECAAAECBAhEBQy80eLEJkCAAAECBAgQIECAAAECBAgQIECAgIHXDxAgQIAAAQIECBAgQIAAAQIECBAgQCAqYOCNFic2AQIECBAgQIAAAQIECBAgQIAAAQIEDLx+gAABAgQIECBAgAABAgQIECBAgAABAlEBA2+0OLEJECBAgAABAgQIECBAgAABAgQIECBg4PUDBAgQIECAAAECBAgQIECAAAECBAgQiAoYeKPFiU2AAAECBAgQIECAAAECBAgQIECAAAEDrx8gQIAAAQIECBAgQIAAAQIECBAgQIBAVMDAGy1ObAIECBAgQIAAAQIECBAgQIAAAQIECBh4/QABAgQIECBAgAABAgQIECBAgAABAgSiAgbeaHFiEyBAgAABAgQIECBAgAABAgQIECBAwMDrBwgQIECAAAECBAgQIECAAAECBAgQIBAVMPBGixObAAECBAgQIECAAAECBAgQIECAAAECBl4/QIAAAQIECBAgQIAAAQIECBAgQIAAgaiAgTdanNgECBAgQIAAAQIECBAgQIAAAQIECBAw8PoBAgQIECBAgAABAgQIECBAgAABAgQIRAUMvNHixCZAgAABAgQIECBAgAABAgQIECBAgICB1w8QIECAAAECBAgQIECAAAECBAgQIEAgKmDgjRYnNgECBAgQIECAAAECBAgQIECAAAECBAy8foAAAQIECBAgQIAAAQIECBAgQIAAAQJRAQNvtDixCRAgQIAAAQIECBAgQIAAAQIECBAgYOD1AwQIECBAgAABAgQIECBAgAABAgQIEIgKGHijxYlNgAABAgQIECBAgAABAgQIECBAgAABA68fIECAAAECBAgQIECAAAECBAgQIECAQFTAwBstTmwCBAgQIECAAAECBAgQIECAAAECBAgYeP0AAQIECBAgQIAAAQIECBAgQIAAAQIEogIG3mhxYhMgQIAAAQIECBAgQIAAAQIECBAgQMDA6wcIECBAgAABAgQIECBAgAABAgQIECAQFTDwRosTmwABAgQIECBAgAABAgQIECBAgAABAgZeP0CAAAECBAgQIECAAAECBAgQIECAAIGogIE3WpzYBAgQIECAAAECBAgQIECAAAECBAgQMPD6AQIECBAgQIAAAQIECBAgQIAAAQIECEQFDLzR4sQmQIAAAQIECBAgQIAAAQIECBAgQICAgdcPECBAgAABAgQIECBAgAABAgQIECBAICpg4I0WJzYBAgQIECBAgAABAgQIECBAgAABAgQMvH6AAAECBAgQIECAAAECBAgQIECAAAECUQEDb7Q4sQkQIECAAAECBAgQIECAAAECBAgQIGDg9QMECBAgQIAAAQIECBAgQIAAAQIECBCIChh4o8WJTYAAAQIECBAgQIAAAQIECBAgQIAAAQOvHyBAgAABAgQIECBAgAABAgQIECBAgEBUwMAbLU5sAgQIECBAgAABAgQIECBAgAABAgQIGHj9AAECBAgQIECAAAECBAgQIECAAAECBKICBt5ocWITIECAAAECBAgQIECAAAECBAgQIEDAwOsHCBAgQIAAAQIECBAgQIAAAQIECBAgEBUw8EaLE5sAAQIECBAgQIAAAQIECBAgQIAAAQIGXj9AgAABAgQIECBAgAABAgQIECBAgACBqICBN1qc2AQIECBAgAABAgQIECBAgAABAgQIEDDw+gECBAgQIECAAAECBAgQIECAAAECBAhEBQy80eLEJkCAAAECBAgQIECAAAECBAgQIECAgIHXDxAgQIAAAQIECBAgQIAAAQIECBAgQCAqYOCNFic2AQIECBAgQIAAAQIECBAgQIAAAQIEDLx+gAABAgQIECBAgAABAgQIECBAgAABAlEBA2+0OLEJECBAgAABAgQIECBAgAABAgQIECBg4PUDBAgQIECAAAECBAgQIECAAAECBAgQiAoYeKPFiU2AAAECBAgQIECAAAECBAgQIECAAAEDrx8gQIAAAQIECBAgQIAAAQIECBAgQIBAVMDAGy1ObAIECBAgQIAAAQIECBAgQIAAAQIECBh4/QABAgQIECBAgAABAgQIECBAgAABAgSiAgbeaHFiEyBAgAABAgQIECBAgAABAgQIECBAwMDrBwgQIECAAAECBAgQIECAAAECBAgQIBAVMPBGixObAAECBAgQIECAAAECBAgQIECAAAECBl4/QIAAAQIECBAgQIAAAQIECBAgQIAAgaiAgTdanNgECBAgQIAAAQIECBAgQIAAAQIECBAw8PoBAgQIECBAgAABAgQIECBAgAABAgQIRAUMvNHixCZAgAABAgQIECBAgAABAgQIECBAgICB1w8QIECAAAECBAgQIECAAAECBAgQIEAgKmDgjRYnNgECBAgQIECAAAECBAgQIECAAAECBAy8foAAAQIECBAgQIAAAQIECBAgQIAAAQJRAQNvtDixCRAgQIAAAQIECBAgQIAAAQIECBAgYOD1AwQIECBAgAABAgQIECBAgAABAgQIEIgKGHijxYlNgAABAgQIECBAgAABAgQIECBAgAABA68fIECAAAECBAgQIECAAAECBAgQIECAQFTAwBstTmwCBAgQIECAAAECBAgQIECAAAECBAgYeP0AAQIECBAgQIAAAQIECBAgQIAAAQIEogIG3mhxYhMgQIAAAQIECBAgQIAAAQIECBAgQMDA6wcIECBAgAABAgQIECBAgAABAgQIECAQFTDwRosTmwABAgQIECBAgAABAgQIECBAgAABAgZeP0CAAAECBAgQIECAAAECBAgQIECAAIGogIE3WpzYBAgQIECAAAECBAgQIECAAAECBAgQMPD6AQIECBAgQIAAAQIECBAgQIAAAQIECEQFDLzR4sQmQIAAAQIECBAgQIAAAQIECBAgQICAgdcPECBAgAABAgQIECBAgAABAgQIECBAICpg4I0WJzYBAgQIECBAgAABAgQIECBAgAABAgQMvH6AAAECBAgQIECAAAECBAgQIECAAAECUQEDb7Q4sQkQIECAAAECBAgQIECAAAECBAgQIGDg9QMECBAgQIAAAQIECBAgQIAAAQIECBCIChh4o8WJTYAAAQIECBAgQIAAAQIECBAgQIAAAQOvHyBAgAABAgQIECBAgAABAgQIECBAgEBUwMAbLU5sAgQIECBAgAABAgQIECBAgAABAgQIGHj9AAECBAgQIECAAAECBAgQIECAAAECBKICBt5ocWITIECAAAECBAgQIECAAAECBAgQIEDAwOsHCBAgQIAAAQIECBAgQIAAAQIECBAgEBUw8EaLE5sAAQIECBAgQIAAAQIECBAgQIAAAQIGXj9AgAABAgQIECBAgAABAgQIECBAgACBqICBN1qc2AQIECBAgAABAgQIECBAgAABAgQIEDDw+gECBAgQIECAAAECBAgQIECAAAECBAhEBQy80eLEJkCAAAECBAgQIECAAAECBAgQIECAgIHXDxAgQIAAAQIECBAgQIAAAQIECBAgQCAqYOCNFic2AQIECBAgQIAAAQIECBAgQIAAAQIEDLx+gAABAgQIECBAgAABAgQIECBAgAABAlEBA2+0OLEJECBAgAABAgQIECBAgAABAgQIECBg4PUDBAgQIECAAAECBAgQIECAAAECBAgQiAoYeKPFiU2AAAECBAgQIECAAAECBAgQIECAAAEDrx8gQIAAAQIECBAgQIAAAQIECBAgQIBAVMDAGy1ObAIECBAgQIAAAQIECBAgQIAAAQIECBh4/QABAgQIECBAgAABAgQIECBAgAABAgSiAgbeaHFiEyBAgAABAgQIECBAgAABAgQIECBAwMDrBwgQIECAAAECBAgQIECAAAECBAgQIBAVMPBGixObAAECBAgQIECAAAECBAgQIECAAAECBl4/QIAAAQIECBAgQIAAAQIECBAgQIAAgaiAgTdanNgECBAgQIAAAQIECBAgQIAAAQIECBAw8PoBAgQIECBAgAABAgQIECBAgAABAgQIRAUMvNHixCZAgAABAgQIECBAgAABAgQIECBAgICB1w8QIECAAAECBAgQIECAAAECBAgQIEAgKmDgjRYnNgECBAgQIECAAAECBAgQIECAAAECBAy8foAAAQIECBAgQIAAAQIECBAgQIAAAQJRAQNvtDixCRAgQIAAAQIECBAgQIAAAQIECBAgYOD1AwQIECBAgAABAgQIECBAgAABAgQIEIgKGHijxYlNgAABAgQIECBAgAABAgQIECBAgAABA68fIECAAAECBAgQIECAAAECBAgQIECAQFTAwBstTmwCBAgQIECAAAECBAgQIECAAAECBAgYeP0AAQIECBAgQIAAAQIECBAgQIAAAQIEogIG3mhxYhMgQIAAAQIECBAgQIAAAQIECBAgQMDA6wcIECBAgAABAgQIECBAgAABAgQIECAQFTDwRosTmwABAgQIECBAgAABAgQIECBAgAABAgZeP0CAAAECBAgQIECAAAECBAgQIECAAIGogIE3WpzYBAgQIECAAAECBAgQIECAAAECBAgQMPD6AQIECBAgQIAAAQIECBAgQIAAAQIECEQFDLzR4sQmQIAAAQIECBAgQIAAAQIECBAgQICAgdcPECBAgAABAgQIECBAgAABAgQIECBAICpg4I0WJzYBAgQIECBAgAABAgQIECBAgAABAgQMvH6AAAECBAgQIECAAAECBAgQIECAAAECUQEDb7Q4sQkQIECAAAECBAgQIECAAAECBAgQIGDg9QMECBAgQIAAAQIECBAgQIAAAQIECBCIChh4o8WJTYAAAQIECBAgQIAAAQIECBAgQIAAgQeRHgVS/sgHUwAAAABJRU5ErkJggg=='

      if (bannerName) {
        const bannerResp = await this.$supabase.storage
          .from(BUCKET)
          .getPublicUrl(bannerName)

        if (bannerResp.data) {
          data.bannerURL = bannerResp.data.publicURL
        } else {
          data.bannerURL = bannerDefault
        }
      } else {
        data.bannerURL = bannerDefault
      }

      this.projects = data
    }
  }
}
</script>

<style lang="scss" scoped>
</style>
